<!DOCTYPE html>
<html>
    <head>
        <script src="FileSaver.js"></script>
        <script src="filetransfer.bundle.js"></script>
    </head>
    <body>
        <input type="file" id="files" name="files[]" multiple />
        <a id="save" target="_blank" download="test">download</a>
        <script>
// file select
function handleFileSelect(evt) {
    var file = evt.target.files[0]; // FileList object

    console.log('file', file.name, file.size, file.type);

    filesize = file.size;

    receiver.metadata = {
        name: file.name,
        size: file.size,
        type: file.type
    };

    sender.send(file, sendChannel)
}
var sender = new FileTransfer.Sender();
var receiver = new FileTransfer.Receiver();
receiver.on('receivedFile', function (file, metadata) {
    saveAs(file, metadata.name);
});
receiver.on('progress', function (received, size) {
});


document.getElementById('files').addEventListener('change', handleFileSelect, false);
        </script>
        <script>
var pc1, pc2, sendChannel, receiveChannel, pcConstraint;

var servers = null;
pcConstraint = null;
pc1 = new webkitRTCPeerConnection(servers, pcConstraint);
pc2 = new webkitRTCPeerConnection(servers, pcConstraint);

pc1.onicecandidate = function (event) {
    if (event.candidate) {
        pc2.addIceCandidate(event.candidate);
    }
}; 

sendChannel = pc1.createDataChannel('filetransfer', {reliable: true});

pc2.onicecandidate = function (event) {
    if (event.candidate) {
        pc1.addIceCandidate(event.candidate);
    }
}; 
pc2.ondatachannel = function (event) {
    receiver.receive(null, event.channel);
};

pc1.createOffer(
    function (offer) {
        pc1.setLocalDescription(offer,
            function() { },
            console.error
        );
        pc2.setRemoteDescription(offer,
            function () {
                pc2.createAnswer(function (answer) {
                        pc2.setLocalDescription(answer, 
                            function () {
                                pc1.setRemoteDescription(answer,
                                    function () { },
                                    console.error
                                );
                            },
                            console.error
                        );
                    },
                    console.error
                );
            },
            console.error
        );
    },
    console.error,
    { mandatory: {
        OfferToReceiveAudio: false,
        OfferToReceiveVideo: false
    }}
);
        </script>
    </body>
</html>
